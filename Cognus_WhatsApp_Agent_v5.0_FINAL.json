{
  "name": "Cognus WhatsApp Agent v5.0",
  "nodes": [
    {
      "id": "1",
      "name": "Webhook WhatsApp Evolution",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        250,
        300
      ],
      "parameters": {
        "httpMethod": "POST",
        "path": "cognus-whatsapp",
        "responseMode": "lastNode",
        "options": {}
      }
    },
    {
      "id": "2",
      "name": "playload",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        450,
        300
      ],
      "parameters": {
        "language": "JavaScript",
        "jsCode": "// Parser v5.0 - Extrai e valida dados do payload Evolution API\\nconst items = $input.all();\\nconst results = [];\\n\\nfor (const item of items) {\\n  try {\\n    const body = item.json.body || item.json;\\n    const data = body.data || body;\\n\\n    // Extra√ß√£o de dados\\n    const from = data.key?.remoteJid || data.from || '';\\n    const fromName = data.pushName || data.fromName || 'Paciente';\\n    const messageType = data.message?.conversation ? 'text' :\\n                       data.message?.extendedTextMessage ? 'text' :\\n                       data.message?.audioMessage ? 'audio' :\\n                       data.message?.imageMessage ? 'image' :\\n                       data.message?.videoMessage ? 'video' :\\n                       data.message?.documentMessage ? 'document' : 'unknown';\\n\\n    // Extra√ß√£o de texto\\n    let text = '';\\n    if (data.message?.conversation) {\\n      text = data.message.conversation;\\n    } else if (data.message?.extendedTextMessage?.text) {\\n      text = data.message.extendedTextMessage.text;\\n    }\\n\\n    // Extra√ß√£o de URL de √°udio\\n    let audioUrl = null;\\n    if (messageType === 'audio' && data.message?.audioMessage?.url) {\\n      audioUrl = data.message.audioMessage.url;\\n    }\\n\\n    // Valida√ß√£o de n√∫mero de telefone\\n    const phoneRegex = /^\\\\d{10,15}@/;\\n    if (!phoneRegex.test(from)) {\\n      throw new Error(`N√∫mero de telefone inv√°lido: ${from}`);\\n    }\\n\\n    // Cria√ß√£o do sessionId (cr√≠tico para o Redis Chat Memory)\\n    const sessionId = from.split('@')[0];\\n\\n    // Timestamp\\n    const timestamp = data.messageTimestamp || Math.floor(Date.now() / 1000);\\n\\n    // Resultado\\n    results.push({\\n      json: {\\n        sessionId: sessionId,  // CAMPO CR√çTICO\\n        dataw: {\\n          event: body.event || 'messages.upsert',\\n          instance: body.instance || 'cognus',\\n          from: from,\\n          fromName: fromName,\\n          message: text,\\n          type: messageType,\\n          audioUrl: audioUrl,\\n          timestamp: timestamp\\n        }\\n      }\\n    });\\n\\n  } catch (error) {\\n    // Em caso de erro, retorna um objeto de erro\\n    results.push({\\n      json: {\\n        error: true,\\n        errorMessage: error.message,\\n        originalPayload: item.json\\n      }\\n    });\\n  }\\n}\\n\\nreturn results;"
      }
    },
    {
      "id": "3",
      "name": "Switch1",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [
        650,
        300
      ],
      "parameters": {
        "mode": "rules",
        "rules": {
          "rules": [
            {
              "conditions": {
                "string": [
                  {
                    "value1": "={{ $json.dataw.type }}",
                    "operation": "equals",
                    "value2": "text"
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "texto"
            },
            {
              "conditions": {
                "string": [
                  {
                    "value1": "={{ $json.dataw.type }}",
                    "operation": "equals",
                    "value2": "audio"
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "audio"
            }
          ]
        },
        "options": {}
      }
    },
    {
      "id": "4",
      "name": "Download Audio",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        850,
        400
      ],
      "parameters": {
        "url": "={{ $json.dataw.audioUrl }}",
        "method": "GET",
        "responseFormat": "file",
        "options": {
          "timeout": 30000
        }
      }
    },
    {
      "id": "5",
      "name": "transcript",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [
        1050,
        400
      ],
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "model": "whisper-1",
        "binaryPropertyName": "data",
        "options": {}
      }
    },
    {
      "id": "6",
      "name": "Set Transcription",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        1250,
        400
      ],
      "parameters": {
        "values": {
          "string": [
            {
              "name": "dataw.message",
              "value": "={{ $json.text }}"
            }
          ]
        },
        "options": {
          "keepOnlySet": false
        }
      }
    },
    {
      "id": "7",
      "name": "push",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        1050,
        300
      ],
      "parameters": {
        "operation": "push",
        "list": "={{ $json.sessionId }}:buffer",
        "messageData": "={{ $json.dataw.message }}",
        "options": {
          "ttl": 300
        }
      }
    },
    {
      "id": "8",
      "name": "Wait",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        1250,
        300
      ],
      "parameters": {
        "resume": "after",
        "amount": 5,
        "unit": "seconds"
      }
    },
    {
      "id": "9",
      "name": "msgs",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        1450,
        300
      ],
      "parameters": {
        "operation": "lrange",
        "list": "={{ $json.sessionId }}:buffer",
        "start": 0,
        "end": -1
      }
    },
    {
      "id": "10",
      "name": "junta_msgs",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        1650,
        300
      ],
      "parameters": {
        "language": "JavaScript",
        "jsCode": "const items = $input.all();\\nconst results = [];\\n\\nfor (const item of items) {\\n  const messages = item.json.list || [];\\n  const formattedHistory = messages.map((msg, index) => {\\n    return `Mensagem ${index + 1}: ${msg}`;\\n  }).join('\\n');\\n\\n  results.push({\\n    json: {\\n      ...item.json,\\n      conversationHistory: formattedHistory\\n    }\\n  });\\n}\\n\\nreturn results;"
      }
    },
    {
      "id": "11",
      "name": "AI Agent",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [
        1850,
        300
      ],
      "parameters": {
        "resource": "chat",
        "operation": "message",
        "model": "gpt-4o",
        "messages": {
          "values": [
            {
              "role": "system",
              "content": "Voc√™ √© o assistente virtual da Cl√≠nica Cognus, uma cl√≠nica especializada em sa√∫de mental e desenvolvimento infantil. Sua fun√ß√£o √© classificar as solicita√ß√µes dos pacientes e fornecer respostas precisas e humanizadas.\n\n## CORPO CL√çNICO (12 profissionais)\n\n### M√©dicos\n- Dr. Tiago Figueiredo, MD, Ph.D. - Psiquiatra (Co-fundador, Criador do Programa VOAR)\n- Dra. Mariana Le√£o, MD. - Cardiologista\n- Dr. Di√™go Figueiredo, MD. - Nefrologista\n- Dra. Anna Gabriela, MD. - Endocrinologista\n- Dr. Allan Marinho - Psiquiatra\n\n### Terapeutas e Psic√≥logos\n- Karla Valente Sanches - Neuropsic√≥loga\n- Ana Carolina Caputo Auc√©lio Rabetti - Fonoaudi√≥loga\n- Wesley Oliveira - Terapeuta Ocupacional\n- Juliana Nogueira, MSc. - Psic√≥loga\n- Gleisse Nunes Pires da Silva - Psic√≥loga, Educadora Parental\n- Ana Paula Gheller - Psic√≥loga\n- Camila Barros Ribeiro - Neuropsic√≥loga\n\n## ESPECIALIDADES (13)\nPsiquiatria, Cardiologia, Nefrologia, Endocrinologia, Cirurgia Vascular, Psicologia, Educa√ß√£o Parental, Fonoaudiologia, Neuropsicologia, Neuropsicopedagogia, Terapia Ocupacional, Avalia√ß√£o do Perfil Cognitivo, Avalia√ß√£o da Cogni√ß√£o Social\n\n## TERAPIAS E PROGRAMAS (6 + 2)\n- Fonoaudiologia\n- Psicoterapia\n- Psicopedagogia\n- Terapia Ocupacional\n- Educa√ß√£o Parental\n- Neuropsicologia\n- **Programa VOAR**: Vida, Organiza√ß√£o, Autonomia e Habilidades - Protocolo internacional para crian√ßas e adolescentes com TDAH, criado pelo Dr. Tiago Figueiredo\n- **Programa de Leitura e Escrita**: Protocolo para dificuldades de aprendizagem\n\n## REGRAS DE NEG√ìCIO\n1. **Agendamentos**: Psiquiatria e Avalia√ß√£o Neuropsicol√≥gica SEMPRE exigem handoff humano.\n2. **Receitas Controladas**: Perguntar a localiza√ß√£o (DF, RJ ou outra).\n3. **Conv√™nio**: A cl√≠nica atende apenas particular.\n4. **Relat√≥rios/Laudos**: Devem ser solicitados por e-mail: contato@clinicacognus.com.br\n\n## ESTRUTURA DE RESPOSTA (JSON)\nVoc√™ DEVE responder SEMPRE em JSON com a seguinte estrutura:\n{\n  \"intent\": \"<receita|agendamento|terapia|relatorio|envio_documento|duvida>\",\n  \"sub_intent\": {},\n  \"response_type\": \"<fixed|generated>\",\n  \"response_text\": \"<string ou null>\",\n  \"handoff_needed\": <boolean>,\n  \"handoff_reason\": \"<string ou null>\"\n}\n\n### Campos:\n- **intent**: A inten√ß√£o principal do usu√°rio\n- **sub_intent**: Detalhes (ex: {\"especialidade\": \"cardiologia\", \"tipo_receita\": \"controlada\", \"localizacao\": \"df\"})\n- **response_type**: \"fixed\" para fluxos cr√≠ticos (agendamento, receita), \"generated\" para d√∫vidas e terapias\n- **response_text**: Texto da resposta (apenas se response_type = \"generated\")\n- **handoff_needed**: true para Psiquiatria, Neuropsicologia, reclama√ß√µes\n- **handoff_reason**: Motivo do handoff\n\n## EXEMPLOS\nUsu√°rio: \"Quero agendar com um cardiologista\"\nResposta:\n{\n  \"intent\": \"agendamento\",\n  \"sub_intent\": {\"especialidade\": \"cardiologia\"},\n  \"response_type\": \"fixed\",\n  \"response_text\": null,\n  \"handoff_needed\": false,\n  \"handoff_reason\": null\n}\n\nUsu√°rio: \"Preciso de uma receita azul, moro em Bras√≠lia\"\nResposta:\n{\n  \"intent\": \"receita\",\n  \"sub_intent\": {\"tipo_receita\": \"controlada\", \"localizacao\": \"df\"},\n  \"response_type\": \"fixed\",\n  \"response_text\": null,\n  \"handoff_needed\": false,\n  \"handoff_reason\": null\n}\n\nUsu√°rio: \"O que √© o programa VOAR?\"\nResposta:\n{\n  \"intent\": \"terapia\",\n  \"sub_intent\": {\"tipo_terapia\": \"voar\"},\n  \"response_type\": \"generated\",\n  \"response_text\": \"O Programa VOAR (Vida, Organiza√ß√£o, Autonomia e Habilidades) √© um protocolo internacional criado pelo Dr. Tiago Figueiredo, focado no tratamento de crian√ßas e adolescentes com TDAH. Ele envolve a participa√ß√£o ativa da fam√≠lia e trabalha habilidades como autonomia, regula√ß√£o emocional e compet√™ncia social. Gostaria de saber mais?\",\n  \"handoff_needed\": false,\n  \"handoff_reason\": null\n}\n\nRetorne sempre exatamente nesse formato JSON.",
            {
              "role": "user",
              "content": "={{ $json.conversationHistory }}"
            }
          ]
        },
        "options": {
          "temperature": 0.3,
          "responseFormat": "json_object"
        }
      }
    },
    {
      "id": "12",
      "name": "Switch por Inten√ß√£o",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [
        2050,
        300
      ],
      "parameters": {
        "mode": "rules",
        "rules": {
          "rules": [
            {
              "conditions": {
                "string": [
                  {
                    "value1": "={{ $json.message.content.intent }}",
                    "operation": "equals",
                    "value2": "receita"
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "receita"
            },
            {
              "conditions": {
                "string": [
                  {
                    "value1": "={{ $json.message.content.intent }}",
                    "operation": "equals",
                    "value2": "agendamento"
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "agendamento"
            },
            {
              "conditions": {
                "string": [
                  {
                    "value1": "={{ $json.message.content.intent }}",
                    "operation": "equals",
                    "value2": "terapia"
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "terapia"
            },
            {
              "conditions": {
                "string": [
                  {
                    "value1": "={{ $json.message.content.intent }}",
                    "operation": "equals",
                    "value2": "relatorio"
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "relatorio"
            },
            {
              "conditions": {
                "boolean": [
                  {
                    "value1": "={{ $json.message.content.handoff_needed }}",
                    "operation": "equals",
                    "value2": true
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "handoff"
            }
          ]
        },
        "options": {}
      }
    },
    {
      "id": "13",
      "name": "Processar Receita",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        2250,
        200
      ],
      "parameters": {
        "language": "JavaScript",
        "jsCode": "const items = $input.all();\\nconst results = [];\\n\\nfor (const item of items) {\\n  const aiResponse = item.json.message.content;\\n  const subIntent = aiResponse.sub_intent || {};\\n  const tipoReceita = subIntent.tipo_receita;\\n  const localizacao = subIntent.localizacao;\\n\\n  let mensagem = '';\\n  let trelloList = null;\\n\\n  if (tipoReceita === 'branca') {\\n    mensagem = 'Receita branca confirmada! O Dr. Tiago enviar√° sua receita diretamente pelo aplicativo da cl√≠nica em at√© 24 horas. üìã';\\n  } else if (tipoReceita === 'controlada') {\\n    if (!localizacao) {\\n      mensagem = 'Para continuar com sua receita controlada, por favor, me informe sua cidade e estado. üìç';\\n    } else {\\n      const protocolo = `REC-${Date.now().toString().slice(-6)}`;\\n\\n      if (localizacao === 'df') {\\n        mensagem = `Receita controlada confirmada para Bras√≠lia/DF! ‚úÖ\\\\n\\\\nSua receita ser√° preparada e voc√™ pode retir√°-la na cl√≠nica em at√© 48 horas.\\\\n\\\\nüìã Protocolo: ${protocolo}`;\\n        trelloList = 'Receitas DF';\\n      } else if (localizacao === 'rj') {\\n        mensagem = `Receita controlada confirmada para Rio de Janeiro/RJ! ‚úÖ\\\\n\\\\nSua receita ser√° preparada e voc√™ pode retir√°-la na cl√≠nica em at√© 48 horas.\\\\n\\\\nüìã Protocolo: ${protocolo}`;\\n        trelloList = 'Receitas RJ';\\n      } else {\\n        mensagem = `Receita controlada confirmada! ‚úÖ\\\\n\\\\nSua receita ser√° enviada pelos Correios em at√© 5 dias √∫teis.\\\\n\\\\nüìã Protocolo: ${protocolo}`;\\n        trelloList = 'Receitas Correios';\\n      }\\n    }\\n  } else {\\n    mensagem = 'Qual tipo de receita voc√™ precisa?\\\\n\\\\n1Ô∏è‚É£ Receita Branca\\\\n2Ô∏è‚É£ Receita Controlada (Azul/Amarela)';\\n  }\\n\\n  results.push({\\n    json: {\\n      ...item.json,\\n      responseMessage: mensagem,\\n      trelloList: trelloList\\n    }\\n  });\\n}\\n\\nreturn results;"
      }
    },
    {
      "id": "14",
      "name": "Processar Agendamento",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        2250,
        300
      ],
      "parameters": {
        "language": "JavaScript",
        "jsCode": "const items = $input.all();\\nconst results = [];\\n\\nconst especialidadesComProfissionais = {\\n  'cardiologia': 'Excelente escolha! A especialidade de Cardiologia √© atendida pela **Dra. Mariana Le√£o, MD.**, uma profissional de refer√™ncia na √°rea. Para agendar sua consulta, entre em contato pelo telefone (61) 3964-9899 ou pelo WhatsApp (61) 99999-9999. üìÖ',\\n  'nefrologia': 'Excelente escolha! A especialidade de Nefrologia √© atendida pelo **Dr. Di√™go Figueiredo, MD.**, Respons√°vel T√©cnico da cl√≠nica. Para agendar sua consulta, entre em contato pelo telefone (61) 3964-9899 ou pelo WhatsApp (61) 99999-9999. üìÖ',\\n  'endocrinologia': 'Excelente escolha! A especialidade de Endocrinologia √© atendida pela **Dra. Anna Gabriela, MD.**. Para agendar sua consulta, entre em contato pelo telefone (61) 3964-9899 ou pelo WhatsApp (61) 99999-9999. üìÖ',\\n  'psicologia': 'Excelente escolha! A especialidade de Psicologia √© atendida por **Juliana Nogueira, MSc.** e **Ana Paula Gheller**. Para agendar sua consulta, entre em contato pelo telefone (61) 3964-9899 ou pelo WhatsApp (61) 99999-9999. üìÖ',\\n  'fonoaudiologia': 'Excelente escolha! A especialidade de Fonoaudiologia √© atendida por **Ana Carolina Caputo Auc√©lio Rabetti**. Para agendar sua consulta, entre em contato pelo telefone (61) 3964-9899 ou pelo WhatsApp (61) 99999-9999. üìÖ',\\n  'terapia_ocupacional': 'Excelente escolha! A Terapia Ocupacional √© atendida por **Wesley Oliveira**. Para agendar sua consulta, entre em contato pelo telefone (61) 3964-9899 ou pelo WhatsApp (61) 99999-9999. üìÖ',\\n  'educacao_parental': 'Excelente escolha! A Educa√ß√£o Parental √© atendida por **Gleisse Nunes Pires da Silva**, certificada em Parentalidade Consciente. Para agendar sua consulta, entre em contato pelo telefone (61) 3964-9899 ou pelo WhatsApp (61) 99999-9999. üìÖ'\\n};\\n\\nfor (const item of items) {\\n  const aiResponse = item.json.message.content;\\n  const subIntent = aiResponse.sub_intent || {};\\n  const especialidade = subIntent.especialidade;\\n\\n  let mensagem = '';\\n\\n  if (!especialidade) {\\n    mensagem = 'Para qual especialidade voc√™ gostaria de agendar?\\\\n\\\\nü©∫ **M√©dicas**: Psiquiatria, Cardiologia, Nefrologia, Endocrinologia, Cirurgia Vascular\\\\n\\\\nüß† **Terapias e Avalia√ß√µes**: Psicologia, Educa√ß√£o Parental, Fonoaudiologia, Neuropsicologia, Neuropsicopedagogia, Terapia Ocupacional, Avalia√ß√£o do Perfil Cognitivo, Avalia√ß√£o da Cogni√ß√£o Social';\\n  } else if (especialidade === 'psiquiatria' || especialidade === 'avaliacao_neuropsicologica') {\\n    mensagem = 'Entendi! Para agendamentos de Psiquiatria e Avalia√ß√£o Neuropsicol√≥gica, vou transferir voc√™ para um de nossos atendentes que poder√° te ajudar melhor. Aguarde um momento! üôã‚Äç‚ôÄÔ∏è';\\n  } else {\\n    mensagem = especialidadesComProfissionais[especialidade] || 'Excelente escolha! Para agendar sua consulta, entre em contato pelo telefone (61) 3964-9899 ou pelo WhatsApp (61) 99999-9999. üìÖ';\\n  }\\n\\n  results.push({\\n    json: {\\n      ...item.json,\\n      responseMessage: mensagem\\n    }\\n  });\\n}\\n\\nreturn results;"
      }
    },
    {
      "id": "15",
      "name": "Processar Terapia",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        2250,
        400
      ],
      "parameters": {
        "language": "JavaScript",
        "jsCode": "const items = $input.all();\\nconst results = [];\\n\\nfor (const item of items) {\\n  const aiResponse = item.json.message.content;\\n  const responseText = aiResponse.response_text;\\n\\n  // Se a IA gerou uma resposta, usamos ela\\n  let mensagem = responseText || 'A Cl√≠nica Cognus oferece:\\\\n\\\\nüó£Ô∏è **Fonoaudiologia** (com Ana Carolina Rabetti)\\\\nüß† **Psicoterapia** (com Juliana Nogueira e Ana Paula Gheller)\\\\nüìö **Psicopedagogia**\\\\nüéØ **Terapia Ocupacional** (com Wesley Oliveira)\\\\nüë®‚Äçüë©‚Äçüëß **Educa√ß√£o Parental** (com Gleisse Nunes Pires da Silva)\\\\nüß© **Neuropsicologia** (com Karla Sanches e Camila Ribeiro)\\\\n\\\\nüöÄ **Programas Especiais**:\\\\n‚Ä¢ **VOAR**: Para crian√ßas e adolescentes com TDAH\\\\n‚Ä¢ **Leitura e Escrita**: Para dificuldades de aprendizagem\\\\n\\\\nSobre qual voc√™ gostaria de saber mais?';\\n\\n  results.push({\\n    json: {\\n      ...item.json,\\n      responseMessage: mensagem\\n    }\\n  });\\n}\\n\\nreturn results;"
      }
    },
    {
      "id": "16",
      "name": "Informar E-mail",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        2250,
        500
      ],
      "parameters": {
        "values": {
          "string": [
            {
              "name": "responseMessage",
              "value": "Para solicitar relat√≥rios e laudos, por favor, envie um e-mail para **contato@clinicacognus.com.br** com os seguintes dados:\\n\\nüìß Nome completo\\nüìß CPF\\nüìß Tipo de documento solicitado\\n\\nO prazo de entrega √© de at√© 7 dias √∫teis. ‚è∞"
            }
          ]
        },
        "options": {
          "keepOnlySet": false
        }
      }
    },
    {
      "id": "17",
      "name": "Handoff Humano",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        2250,
        600
      ],
      "parameters": {
        "values": {
          "string": [
            {
              "name": "responseMessage",
              "value": "Entendi! Vou transferir voc√™ para um de nossos atendentes que poder√° te ajudar melhor. Aguarde um momento! üôã‚Äç‚ôÄÔ∏è"
            }
          ]
        },
        "options": {
          "keepOnlySet": false
        }
      }
    },
    {
      "id": "18",
      "name": "Create Card in Trello",
      "type": "n8n-nodes-base.trello",
      "typeVersion": 1,
      "position": [
        2450,
        200
      ],
      "parameters": {
        "operation": "create",
        "boardId": "{{ID_DO_BOARD}}",
        "listId": "={{ $json.trelloList }}",
        "name": "Receita - {{ $json.dataw.fromName }}",
        "description": "Paciente: {{ $json.dataw.fromName }}\\nTelefone: {{ $json.dataw.from }}\\nTipo: {{ $json.message.content.sub_intent.tipo_receita }}\\nLocaliza√ß√£o: {{ $json.message.content.sub_intent.localizacao }}\\nData: {{ $now }}"
      }
    },
    {
      "id": "19",
      "name": "Enviar texto",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        2650,
        300
      ],
      "parameters": {
        "url": "{{EVOLUTION_API_URL}}/message/sendText/{{INSTANCE_NAME}}",
        "method": "POST",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{$env.EVOLUTION_API_KEY}}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $json.dataw.from }}"
            },
            {
              "name": "text",
              "value": "={{ $json.responseMessage }}"
            }
          ]
        },
        "options": {
          "timeout": 10000
        }
      }
    }
  ],
  "connections": {
    "Webhook WhatsApp Evolution": {
      "main": [
        [
          {
            "node": "playload",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "playload": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "push",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Download Audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Audio": {
      "main": [
        [
          {
            "node": "transcript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "transcript": {
      "main": [
        [
          {
            "node": "Set Transcription",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Transcription": {
      "main": [
        [
          {
            "node": "push",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "push": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "msgs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "msgs": {
      "main": [
        [
          {
            "node": "junta_msgs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "junta_msgs": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Switch por Inten√ß√£o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch por Inten√ß√£o": {
      "main": [
        [
          {
            "node": "Processar Receita",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Processar Agendamento",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Processar Terapia",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Informar E-mail",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Handoff Humano",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Processar Receita": {
      "main": [
        [
          {
            "node": "Enviar texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Processar Agendamento": {
      "main": [
        [
          {
            "node": "Enviar texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Processar Terapia": {
      "main": [
        [
          {
            "node": "Enviar texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Informar E-mail": {
      "main": [
        [
          {
            "node": "Enviar texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Handoff Humano": {
      "main": [
        [
          {
            "node": "Enviar texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {},
  "versionId": "v5.0"
}
